# 评测脚本使用建议

## 一、脚本对比总结

| 脚本 | 位置 | 来源 | 状态 | 推荐度 |
|------|------|------|------|--------|
| **`eval_all.py`** | `TalkingGaussian/scripts/eval_all.py` | TalkingGaussian 官方 | ✅ **保留** | ⭐⭐⭐⭐⭐ |
| **`run_eval.sh`** | `TalkingGaussian/evaluation/run_eval.sh` | 我创建的包装脚本 | ✅ **保留** | ⭐⭐⭐⭐ |
| **`run_all_metrics.sh`** | `TalkingGaussian/evaluation/run_all_metrics.sh` | 我创建的封装脚本 | ⚠️ **可选保留** | ⭐⭐⭐ |
| **`run_eval_from_system.sh`** | `TalkingGaussian/evaluation/run_eval_from_system.sh` | 我创建的便捷脚本 | ✅ **保留** | ⭐⭐⭐⭐ |

## 二、如果只保留一个脚本

### 推荐：保留 `eval_all.py`（官方脚本）

**理由：**
1. ✅ **官方维护**：TalkingGaussian 项目官方脚本，更可靠、更稳定
2. ✅ **功能完整**：支持所有评测指标（PSNR/SSIM/LPIPS/NIQE/FID/LSE）
3. ✅ **参数灵活**：支持更多参数选项（FID 后端选择、LSE preset、LPIPS 网络等）
4. ✅ **错误处理**：NIQE 失败不会导致整个脚本失败（`allow_fail=True`）
5. ✅ **输出格式**：支持 JSON 输出（`--json-out`）

**使用方法：**
```bash
# 方式1：手动激活环境（推荐）
conda activate talking_gaussian
cd /root/TFG_ui/TalkingGaussian
python scripts/eval_all.py \
  --pred-video /path/to/pred.mp4 \
  --gt-video /path/to/gt.mp4 \
  --all \
  --json-out /path/to/metrics.json

# 方式2：使用 conda run（无需激活）
conda run -n talking_gaussian --no-capture-output \
  python scripts/eval_all.py \
    --pred-video /path/to/pred.mp4 \
    --gt-video /path/to/gt.mp4 \
    --all \
    --json-out /path/to/metrics.json
```

## 三、推荐的脚本组合

### 方案1：保留官方脚本 + 包装脚本（推荐）

**保留：**
- ✅ `eval_all.py`：官方脚本，核心功能
- ✅ `run_eval.sh`：包装脚本，自动处理环境切换
- ✅ `run_eval_from_system.sh`：便捷脚本，自动查找系统生成的文件

**删除：**
- ❌ `run_all_metrics.sh`：功能与 `eval_all.py` 重复，可以删除

**使用方式：**
```bash
# 方式1：使用包装脚本（最简单）
bash TalkingGaussian/evaluation/run_eval.sh \
  --pred-video /path/to/pred.mp4 \
  --gt-video /path/to/gt.mp4 \
  --all \
  --json-out /path/to/metrics.json

# 方式2：使用便捷脚本（自动查找文件）
bash TalkingGaussian/evaluation/run_eval_from_system.sh \
  --project_name May \
  --output_file /path/to/metrics.json

# 方式3：直接使用官方脚本（最灵活）
conda activate talking_gaussian
python TalkingGaussian/scripts/eval_all.py \
  --pred-video /path/to/pred.mp4 \
  --gt-video /path/to/gt.mp4 \
  --all
```

### 方案2：只保留官方脚本（最简洁）

**保留：**
- ✅ `eval_all.py`：官方脚本，核心功能

**删除：**
- ❌ `run_eval.sh`：包装脚本（可选）
- ❌ `run_all_metrics.sh`：封装脚本（可删除）
- ❌ `run_eval_from_system.sh`：便捷脚本（可选）

**使用方式：**
```bash
# 直接使用官方脚本
conda activate talking_gaussian
python TalkingGaussian/scripts/eval_all.py \
  --pred-video /path/to/pred.mp4 \
  --gt-video /path/to/gt.mp4 \
  --all \
  --json-out /path/to/metrics.json
```

## 四、脚本功能对比

| 功能 | `eval_all.py` | `run_eval.sh` | `run_all_metrics.sh` | `run_eval_from_system.sh` |
|------|--------------|--------------|---------------------|-------------------------|
| **来源** | 官方 | 我创建 | 我创建 | 我创建 |
| **环境切换** | 手动 | 自动 | 自动 | 自动 |
| **参数格式** | `--pred-video` | `--pred-video` | `--pred_dir` | `--project_name` |
| **自动查找文件** | ❌ | ❌ | ❌ | ✅ |
| **支持 LPIPS** | ✅ | ✅ | ❌ | ❌ |
| **FID 后端选择** | ✅ | ✅ | ❌ | ❌ |
| **LSE preset** | ✅ | ✅ | ❌ | ❌ |
| **JSON 输出** | 可选 | 可选 | 必需 | 必需 |
| **错误处理** | ✅ | ✅ | ⚠️ | ⚠️ |

## 五、最终建议

### 推荐方案：保留 `eval_all.py` + `run_eval.sh` + `run_eval_from_system.sh`

**理由：**
1. **`eval_all.py`**：核心功能，官方维护，必须保留
2. **`run_eval.sh`**：包装脚本，自动处理环境切换，使用简单
3. **`run_eval_from_system.sh`**：便捷脚本，自动查找系统生成的文件，适合日常使用
4. **`run_all_metrics.sh`**：功能与 `eval_all.py` 重复，可以删除或保留作为备用

### 使用场景

- **需要灵活控制参数**：使用 `eval_all.py`
- **简单评测，不想手动切换环境**：使用 `run_eval.sh`
- **评测系统生成的文件**：使用 `run_eval_from_system.sh`

## 六、Docker 环境中的使用

在 Docker 容器中，所有脚本都可以正常使用：

```bash
# 进入容器
docker exec -it tfg_ui bash

# 方式1：使用包装脚本
bash TalkingGaussian/evaluation/run_eval.sh \
  --pred-video /app/static/videos/pred.mp4 \
  --gt-video /app/TalkingGaussian/data/May/May.mp4 \
  --all \
  --json-out /app/static/metrics.json

# 方式2：使用便捷脚本
bash TalkingGaussian/evaluation/run_eval_from_system.sh \
  --project_name May \
  --output_file /app/static/metrics.json

# 方式3：直接使用官方脚本
conda activate talking_gaussian
python TalkingGaussian/scripts/eval_all.py \
  --pred-video /app/static/videos/pred.mp4 \
  --gt-video /app/TalkingGaussian/data/May/May.mp4 \
  --all \
  --json-out /app/static/metrics.json
```

## 七、总结

**如果只保留一个脚本**：保留 `eval_all.py`（官方脚本）

**推荐保留的脚本组合**：
1. `eval_all.py`：核心功能，官方维护
2. `run_eval.sh`：包装脚本，自动处理环境切换
3. `run_eval_from_system.sh`：便捷脚本，自动查找文件

**可以删除的脚本**：
- `run_all_metrics.sh`：功能与 `eval_all.py` 重复（可选保留作为备用）

