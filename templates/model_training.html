<!DOCTYPE html>  
<html lang="zh">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Ê®°ÂûãËÆ≠ÁªÉÁïåÈù¢</title>  
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">  
    <style>  
        :root {  
            --primary-color: #00c6ff;  
            --secondary-color: #0072ff;  
            --accent-color: #00e5ff;  
            --bg-dark: #0a0a0a;  
            --bg-light: #1b1b1b;  
            --text-primary: #ffffff;  
            --text-secondary: rgba(255, 255, 255, 0.7);  
            --glass-bg: rgba(255, 255, 255, 0.05);  
            --glass-border: rgba(255, 255, 255, 0.2);  
            --neon-glow: rgba(0, 229, 255, 0.8);  
        }  
  
        body.subpage-bg {  
            background: radial-gradient(circle at center, var(--bg-dark) 0%, var(--bg-light) 100%);  
            color: var(--text-primary);  
            font-family: "Segoe UI", "Microsoft YaHei", sans-serif;  
            margin: 0;  
            padding: 20px;  
            min-height: 100vh;  
            position: relative;  
            overflow-x: hidden;  
        }  
  
        /* Á≤íÂ≠êËÉåÊôØÊïàÊûú */  
        body.subpage-bg::before {  
            content: '';  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background-image:   
                radial-gradient(circle at 20% 50%, rgba(0, 198, 255, 0.1) 0%, transparent 50%),  
                radial-gradient(circle at 80% 80%, rgba(0, 114, 255, 0.1) 0%, transparent 50%),  
                radial-gradient(circle at 40% 20%, rgba(0, 229, 255, 0.1) 0%, transparent 50%);  
            animation: particleFloat 20s ease-in-out infinite;  
            pointer-events: none;  
            z-index: 0;  
        }  
  
        .page-header {  
            display: flex;  
            align-items: center;  
            gap: 20px;  
            margin-bottom: 30px;  
            position: relative;  
            z-index: 1;  
        }  
          
        .back-btn {  
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));  
            border: 2px solid rgba(0, 229, 255, 0.3);  
            color: var(--text-primary);  
            padding: 12px 24px;  
            border-radius: 10px;  
            cursor: pointer;  
            font-size: 14px;  
            font-weight: bold;  
            transition: all 0.3s ease;  
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.3);  
            position: relative;  
            overflow: hidden;  
        }  
          
        .back-btn::before {  
            content: '';  
            position: absolute;  
            top: 50%;  
            left: 50%;  
            width: 0;  
            height: 0;  
            border-radius: 50%;  
            background: rgba(255, 255, 255, 0.2);  
            transform: translate(-50%, -50%);  
            transition: width 0.6s, height 0.6s;  
        }  
          
        .back-btn:hover::before {  
            width: 200px;  
            height: 200px;  
        }  
          
        .back-btn:hover {  
            transform: translateY(-2px);  
            box-shadow: 0 0 30px rgba(0, 229, 255, 0.5);  
            border-color: var(--accent-color);  
        }  
          
        h2 {  
            margin: 0;  
            color: var(--accent-color);  
            font-size: 2rem;  
            text-shadow: 0 0 20px rgba(0, 229, 255, 0.6);  
            animation: glowText 3s infinite alternate;  
        }  
  
        .video-page-container {  
            display: flex;  
            max-width: 1200px;  
            margin: 0 auto;  
            background: var(--glass-bg);  
            border: 1px solid var(--glass-border);  
            border-radius: 20px;  
            box-shadow: 0 0 40px rgba(0, 200, 255, 0.2);  
            backdrop-filter: blur(15px);  
            overflow: hidden;  
            position: relative;  
            z-index: 1;  
        }  
  
        .video-display {  
            flex: 1;  
            padding: 30px;  
            display: flex;  
            flex-direction: column;  
            align-items: center;  
            background: rgba(0, 0, 0, 0.2);  
        }  
  
        .video-display video {  
            border-radius: 15px;  
            box-shadow: 0 0 30px rgba(0, 229, 255, 0.4);  
            margin-bottom: 20px;  
            border: 2px solid var(--glass-border);  
        }  
  
        .form-section {  
            flex: 1;  
            padding: 30px;  
            background: rgba(255, 255, 255, 0.02);  
            border-left: 1px solid var(--glass-border);  
        }  
  
        .form-group {  
            margin-bottom: 25px;  
        }  
  
        label {  
            display: block;  
            margin-bottom: 10px;  
            font-weight: bold;  
            color: var(--text-primary);  
            font-size: 14px;  
            text-transform: uppercase;  
            letter-spacing: 1px;  
        }  
  
        select, input, textarea {  
            width: 100%;  
            padding: 12px 15px;  
            border: 2px solid var(--glass-border);  
            border-radius: 10px;  
            font-size: 16px;  
            box-sizing: border-box;  
            background: rgba(255, 255, 255, 0.05);  
            color: var(--text-primary);  
            transition: all 0.3s ease;  
        }  
  
        select:focus, input:focus, textarea:focus {  
            outline: none;  
            border-color: var(--accent-color);  
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.3);  
            background: rgba(255, 255, 255, 0.08);  
        }  
  
        select option {  
            background: var(--bg-dark);  
            color: var(--text-primary);  
        }  
  
        textarea {  
            min-height: 100px;  
            resize: vertical;  
        }  
  
        .generate-btn {  
            width: 100%;  
            padding: 15px;  
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));  
            color: var(--text-primary);  
            border: 2px solid rgba(0, 229, 255, 0.3);  
            border-radius: 12px;  
            font-size: 18px;  
            font-weight: bold;  
            cursor: pointer;  
            transition: all 0.3s ease;  
            text-transform: uppercase;  
            letter-spacing: 2px;  
            position: relative;  
            overflow: hidden;  
        }  
  
        .generate-btn::before {  
            content: '';  
            position: absolute;  
            top: 50%;  
            left: 50%;  
            width: 0;  
            height: 0;  
            border-radius: 50%;  
            background: rgba(255, 255, 255, 0.2);  
            transform: translate(-50%, -50%);  
            transition: width 0.6s, height 0.6s;  
        }  
  
        .generate-btn:hover::before {  
            width: 300px;  
            height: 300px;  
        }  
  
        .generate-btn:hover {  
            transform: translateY(-2px);  
            box-shadow: 0 0 30px rgba(0, 229, 255, 0.5);  
            border-color: var(--accent-color);  
        }  
  
        .generate-btn:active {  
            transform: scale(0.98);  
        }  
  
        /* Âä®ÁîªÂÆö‰πâ */  
        @keyframes particleFloat {  
            0%, 100% { transform: translate(0, 0) rotate(0deg); }  
            33% { transform: translate(30px, -30px) rotate(120deg); }  
            66% { transform: translate(-20px, 20px) rotate(240deg); }  
        }  
  
        @keyframes glowText {  
            from {   
                text-shadow: 0 0 20px var(--accent-color);  
                filter: brightness(1);  
            }  
            to {   
                text-shadow: 0 0 35px var(--accent-color), 0 0 60px var(--primary-color);  
                filter: brightness(1.3);  
            }  
        }  
  
        /* ÂìçÂ∫îÂºèËÆæËÆ° */  
        @media (max-width: 768px) {  
            .video-page-container {  
                flex-direction: column;  
            }  
              
            .form-section {  
                border-left: none;  
                border-top: 1px solid var(--glass-border);  
            }  
              
            h2 {  
                font-size: 1.5rem;  
            }  
              
            .page-header {  
                flex-direction: column;  
                text-align: center;  
                gap: 15px;  
            }  
        }  
  
        /* Âä†ËΩΩÁä∂ÊÄÅ */  
        .loading-overlay {  
            position: fixed;  
            top: 0;  
            left: 0;  
            width: 100%;  
            height: 100%;  
            background: var(--bg-dark);  
            display: flex;  
            justify-content: center;  
            align-items: center;  
            z-index: 9999;  
            opacity: 0;  
            pointer-events: none;  
            transition: opacity 0.3s ease;  
        }  
  
        .loading-overlay.active {  
            opacity: 1;  
            pointer-events: all;  
        }  
  
        .loading-spinner {  
            width: 50px;  
            height: 50px;  
            border: 3px solid var(--glass-border);  
            border-top: 3px solid var(--primary-color);  
            border-radius: 50%;  
            animation: spin 1s linear infinite;  
        }  
  
        @keyframes spin {  
            0% { transform: rotate(0deg); }  
            100% { transform: rotate(360deg); }  
        }  
    </style>  
</head>  
<body class="subpage-bg">  
    <!-- Âä†ËΩΩÂä®Áîª -->  
    <div class="loading-overlay" id="loadingOverlay">  
        <div class="loading-spinner"></div>  
    </div>  
  
    <div class="page-header">  
        <button onclick="goHome()" class="back-btn">‚Üê ËøîÂõûÈ¶ñÈ°µ</button>  
        <h2>üß† Ê®°ÂûãËÆ≠ÁªÉÁïåÈù¢</h2>  
    </div>  
      
    <div class="video-page-container">  
        <!-- Â∑¶‰æßÔºöËÆ≠ÁªÉÁªìÊûúËßÜÈ¢ë -->  
        <div class="video-display">  
            <video id="trainVideo" controls width="420">  
                <source src="{{ url_for('static', filename='videos/sample.mp4') }}" type="video/mp4">  
            </video>  
        </div>  
  
        <!-- Âè≥‰æßÔºöËæìÂÖ•Ê°Ü -->  
        <div class="form-section">  
            <form id="trainForm">  
                <div class="form-group">  
                    <label>Ê®°ÂûãÈÄâÊã©</label>  
                    <select name="model_choice">  
                        <option value="modelA">Model A</option>  
                        <option value="modelB">Model B</option>  
                        <option value="SyncTalk">SyncTalk</option>  
                    </select>  
                </div>  
  
                <div class="form-group">  
                    <label>ÂèÇËÄÉËßÜÈ¢ë/ÂõæÂÉèÂú∞ÂùÄ</label>  
                    <input type="text" name="ref_video" placeholder="ËØ∑ËæìÂÖ•ÂèÇËÄÉËßÜÈ¢ëÊàñÂõæÂÉèÁöÑÁõ∏ÂØπË∑ØÂæÑ">  
                </div>  
  
                <div class="form-group">  
                    <label>GPUÈÄâÊã©</label>  
                    <select name="gpu_choice">  
                        <option value="GPU0">GPU 0</option>  
                        <option value="GPU1">GPU 1</option>  
                    </select>  
                </div>  
  
                <div class="form-group">  
                    <label>EpochÔºàËÆ≠ÁªÉËΩÆÊï∞Ôºâ</label>  
                    <input type="number" name="epoch" min="1" value="10">  
                </div>  
  
                <div class="form-group">  
                    <label>Ëá™ÂÆö‰πâËÆ≠ÁªÉÂèÇÊï∞</label>  
                    <textarea name="custom_params" placeholder="ËØ∑ËæìÂÖ•Ëá™ÂÆö‰πâÂèÇÊï∞..."></textarea>  
                </div>  
  
                <button type="submit" class="generate-btn">üöÄ Training!</button>  
            </form>  
        </div>  
    </div>  
  
    <script>  
        // ËøîÂõûÈ¶ñÈ°µÂáΩÊï∞  
        function goHome() {  
            // ÊòæÁ§∫Âä†ËΩΩÂä®Áîª  
            const loadingOverlay = document.getElementById('loadingOverlay');  
            loadingOverlay.classList.add('active');  
              
            // Ê∏ÖÈô§ÂèØËÉΩÁöÑÁºìÂ≠òÈóÆÈ¢ò  
            if ('serviceWorker' in navigator) {  
                navigator.serviceWorker.getRegistrations().then(function(registrations) {  
                    for(let registration of registrations) {  
                        registration.unregister();  
                    }  
                });  
            }  
              
            // Âº∫Âà∂Âà∑Êñ∞È¶ñÈ°µ  
            setTimeout(() => {  
                window.location.href = '/?t=' + new Date().getTime();  
            }, 300);  
        }  
  
        document.getElementById('trainForm').addEventListener('submit', function (e) {  
            e.preventDefault();  
            const formData = new FormData(this);  
  
            // ÊòæÁ§∫Âä†ËΩΩÂä®Áîª  
            const loadingOverlay = document.getElementById('loadingOverlay');  
            loadingOverlay.classList.add('active');  
  
            // Á´ãÂç≥‰ªéË°®ÂçïËé∑ÂèñËßÜÈ¢ëË∑ØÂæÑÂπ∂Êí≠Êîæ  
            const refVideoPath = formData.get('ref_video');  
            const videoEl = document.getElementById('trainVideo');  
  
            if (refVideoPath) {  
                // Á´ãÂç≥ËÆæÁΩÆËßÜÈ¢ëÊ∫êÂπ∂Êí≠Êîæ  
                const newSrc = "/" + refVideoPath.replace("\\", "/") + '?t=' + new Date().getTime();  
                videoEl.src = newSrc;  
                videoEl.load();  
                videoEl.play().catch(e => console.log('Ëá™Âä®Êí≠ÊîæÂèØËÉΩË¢´ÈòªÊ≠¢:', e));  
            }  
  
            fetch('/model_training', {  
                method: 'POST',  
                body: formData  
            })  
                .then(res => res.json())  
                .then(data => {  
                    if (data.status === 'success') {  
                        // ÂàõÂª∫ÊàêÂäüÊèêÁ§∫  
                        showNotification('ËÆ≠ÁªÉÂÆåÊàêÔºÅ', 'success');  
                    }  
                })  
                .catch(err => {  
                    console.error('ÈîôËØØ:', err);  
                    showNotification('ËÆ≠ÁªÉÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'error');  
                })  
                .finally(() => {  
                    // ÈöêËóèÂä†ËΩΩÂä®Áîª  
                    setTimeout(() => {  
                        loadingOverlay.classList.remove('active');  
                    }, 500);  
                });  
        });  
  
        // ÈÄöÁü•ÊèêÁ§∫ÂáΩÊï∞  
        function showNotification(message, type) {  
            const notification = document.createElement('div');  
            notification.style.cssText = `  
                position: fixed;  
                top: 20px;  
                right: 20px;  
                padding: 15px 25px;  
                background: ${type === 'success' ? 'linear-gradient(135deg, #00c6ff, #0072ff)' : 'linear-gradient(135deg, #ff4757, #ff6348)'};  
                color: white;  
                border-radius: 10px;  
                box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);  
                z-index: 10000;  
                animation: slideIn 0.3s ease;  
                font-weight: bold;  
            `;  
            notification.textContent = message;  
              
            document.body.appendChild(notification);  
              
            setTimeout(() => {  
                notification.style.animation = 'slideOut 0.3s ease';  
                setTimeout(() => notification.remove(), 300);  
            }, 3000);  
        }  
  
        // Ê∑ªÂä†Âä®ÁîªÊ†∑Âºè  
        const style = document.createElement('style');  
        style.textContent = `  
            @keyframes slideIn {  
                from { transform: translateX(100%); opacity: 0; }  
                to { transform: translateX(0); opacity: 1; }  
            }  
            @keyframes slideOut {  
                from { transform: translateX(0); opacity: 1; }  
                to { transform: translateX(100%); opacity: 0; }  
            }  
        `;  
        document.head.appendChild(style);  
  
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÈöêËóèÂä†ËΩΩÂä®Áîª  
        document.addEventListener('DOMContentLoaded', function() {  
            const loadingOverlay = document.getElementById('loadingOverlay');  
            loadingOverlay.classList.remove('active');  
        });  
    </script>  
</body>  
</html>
